<!DOCTYPE html>
<html>

<head>
    <title>Mi Biblioteca</title>
    <link rel="icon" href="data:,">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <header id="header-container">
        <!-- Aqui se insertara el menu dinamicamente -->
    </header>

    <div id="app-container">
        <!-- Aqu칤 se cargar치n din치micamente los otros HTML -->
    </div>
    
    // Scripts de las diferentes funcionalidades
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/libros.js"></script>



    <script>
        // Variables globales
        const API_URL = "http://localhost:8000/api/libros";
        const AUTH_URL = "http://localhost:8000/auth";
        let token = localStorage.getItem('token') || null;

        // Funci칩n para cargar p치ginas
        async function loadPage(page) {
            try {
                const response = await fetch(`/static/${page}`);
                const html = await response.text();
                document.getElementById('app-container').innerHTML = html;

                //Quitar CSS anterior(si existe)
                const oldLink = document.getElementById('page-style');
                if (oldLink) oldLink.remove();

                //Cargar CSS correspondiente a la pagina
                const cssFile = page.replace('.html', '.css');
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = `/static/css/${cssFile}`;
                link.id = 'page-style';
                document.head.appendChild(link);

                // Configurar eventos especificos segun la pagina
                if (page === 'main.html'){
                    setupLibroForm();
                    cargarLibros();
                } else if (page === 'guardar.html'){
                    setupGuardarForm();
                } else if (page === 'login.html'){
                    document.getElementById('login-email').focus();
                } else if (page === 'register.html'){
                    document.getElementById('register-name').focus();
                } else if (page === 'libros.html'){
                    cargarLibros();
                } else if (page === 'perfil.html'){
                    cargarPerfil();
                }
                
            } catch (error) {
                console.error('Error loading page:', error);
            }
        }

        // Verificar autenticaci칩n
        function checkAuth() {
            if (token) {
                renderMenu();
                loadPage('main.html');
                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            } else {
                renderMenu();
                loadPage('login.html');
                delete axios.defaults.headers.common['Authorization'];
            }
        }
        function renderMenu() {
            const header = document.getElementById('header-container');

            if (!token) {
                header.innerHTML = "";
                header.className = ""; // quitar estilos si no hay sesi칩n
                return;
            }

            header.className = "header-biblio"; // aplicar clase al header principal
            header.innerHTML = `
        <div class="logo">
            <h1>游닄 Fast-Libros</h1>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="#" onclick="loadPage('main.html')">Inicio</a></li>
                <li><a href="#" onclick="loadPage('guardar.html')">Guardar</a></li>
                <li><a href="#" onclick="loadPage('libros.html')">Libros</a></li>
                <li><a href="#" onclick="loadPage('prefil.html')">Perfil</a></li>
            </ul>
        </nav>
        <button onclick="logout()" class="logout-btn">Cerrar sesi칩n</button>
    `;
        }

        // Iniciar cuando se carga la p치gina
        document.addEventListener('DOMContentLoaded', checkAuth);

        // Efectos dinamicos para el menu 

        window.addEventListener('scroll', function () {
            const header = document.querySelector('.header-biblio');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // Crear part칤culas de fondo (opcional)
        function createParticles() {
            const container = document.createElement('div');
            container.className = 'bg-particles';
            document.body.appendChild(container);

            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 60 + 20 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.opacity = Math.random() * 0.3 + 0.1;
                container.appendChild(particle);
            }
        }

        // Llamar a la funci칩n de part칤culas si quieres el efecto
        // createParticles();
    </script>
</body>

</html>